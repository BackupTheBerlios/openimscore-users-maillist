<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] Question about &quot;ACK not following dialog routes discarded silently!!!&quot;
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Question%20about%20%22ACK%20not%20following%20dialog%0A%20routes%20discarded%20silently%21%21%21%22&In-Reply-To=%3C4A1A72DE.4050201%40fokus.fraunhofer.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005430.html">
   <LINK REL="Next"  HREF="005434.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] Question about &quot;ACK not following dialog routes discarded silently!!!&quot;</H1>
    <B>Dragos Vingarzan</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Question%20about%20%22ACK%20not%20following%20dialog%0A%20routes%20discarded%20silently%21%21%21%22&In-Reply-To=%3C4A1A72DE.4050201%40fokus.fraunhofer.de%3E"
       TITLE="[OpenIMSCore-Users] Question about &quot;ACK not following dialog routes discarded silently!!!&quot;">Dragos.Vingarzan at fokus.fraunhofer.de
       </A><BR>
    <I>Mon May 25 12:28:46 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005430.html">[OpenIMSCore-Users] (no subject)
</A></li>
        <LI>Next message: <A HREF="005434.html">[OpenIMSCore-Users] ims with pstn
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5433">[ date ]</a>
              <a href="thread.html#5433">[ thread ]</a>
              <a href="subject.html#5433">[ subject ]</a>
              <a href="author.html#5433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Chung,

Sorry, for replying so late. It seems that you have hit the bug on not
being able to call yourself. The 2nd trace was between different devices.

Anyway, if you have already a patch, please send it to me for inclusion
(I am not sure if you changed some code or configs).

Cheers,
-Dragos

sssere as wrote:
&gt;<i> Hi Dragos,
</I>&gt;<i>
</I>&gt;<i> Thank you for your response. I've tried the varient 2 in pcscf.cfg but
</I>&gt;<i> it was the same.
</I>&gt;<i>
</I>&gt;<i> I think the problem may happen in the Record-Route of the INVITE. I
</I>&gt;<i> captured more packets. 1-2s.cap: line 1 calls line 2 both on the same
</I>&gt;<i> device. 1-3s.cap: line 1 calls line 3 where line 3 is OpenICLite.
</I>&gt;<i>
</I>&gt;<i> In 1-3s.cap, the INVITE from pcscf to line 3 (packet #16) has 4
</I>&gt;<i> Record-Route. But in 1-2s.cap, the INVITE from pcscf to line 2 (packet
</I>&gt;<i> #16) has only 3 Record-Route, one is missing. Then the 200 OK and ACK
</I>&gt;<i> follow the Record-Route in the INVITE and the ACK is dropped.
</I>&gt;<i>
</I>&gt;<i> In the pcscf, the INVITE from caller is sent to scscf and then sent
</I>&gt;<i> back to pcscf and pcscf sends it to callee. I think in pcscf of
</I>&gt;<i> 1-2s.cap, the INVITEs from caller and to callee are treated as the
</I>&gt;<i> same dialog because they have the same call-id, host and port. That's
</I>&gt;<i> why I add &amp;dir when calling is_p_dialog. Do you have any comments?
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> CW Chung
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i> *&#23492;&#20214;&#32773;&#65306;* Dragos Vingarzan &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">Dragos.Vingarzan at fokus.fraunhofer.de</A>&gt;
</I>&gt;<i> *&#25910;&#20214;&#32773;&#65306;* sssere as &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">cwchungcwchung at yahoo.com.tw</A>&gt;
</I>&gt;<i> *&#21103;&#12288;&#26412;&#65306;* <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>
</I>&gt;<i> *&#23492;&#20214;&#26085;&#26399;&#65306;* 2009/4/28(&#26143;&#26399;&#20108;) &#19978;&#21320;1:08:04
</I>&gt;<i> *&#20027;&#12288;&#26088;&#65306;* Re: [OpenIMSCore-Users] Question about &quot;ACK not following
</I>&gt;<i> dialog routes discarded silently!!!&quot;
</I>&gt;<i>
</I>&gt;<i> Not really. There is also the call-id to differentiate.
</I>&gt;<i>
</I>&gt;<i> The problem is that the ACK does not contain the proper Dialog Routes
</I>&gt;<i> set by the Record-Route headers in the 200 OK. You should fix the
</I>&gt;<i> client. Alternatively, until you have a solution there, you can check
</I>&gt;<i> the pcscf.cfg and enable the other variant on dialog routes checks,
</I>&gt;<i> which uses the P_enforce_dialog_routes() to replace the wrong routes
</I>&gt;<i> with the right ones.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> -Dragos
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> sssere as wrote:
</I>&gt;<i> &gt; Hi all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My device has 2 FXS lines. When line 1 calls line 2 and line 2
</I>&gt;<i> &gt; off-hook, the ACK to 200 OK sent by line 1 is dropped by pcscf. I
</I>&gt;<i> &gt; think maybe this is because the 2 lines are with the same IP and port.
</I>&gt;<i> &gt; So I modify the ser_ims/modules/pcscf/dlg_state.c: P_is_in_dialog():
</I>&gt;<i> &gt; if (is_p_dialog(call_id,host,port,transport,0)) to
</I>&gt;<i> &gt; if (is_p_dialog(call_id,host,port,transport,&amp;dir))
</I>&gt;<i> &gt; and it works. Am I right?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; CW Chung
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &#20184;&#36027;&#25165;&#23481;&#37327;&#28961;&#19978;&#38480;&#65311;Yahoo!&#22855;&#25705;&#38651;&#23376;&#20449;&#31665;2.0&#20813;&#36027;&#32102;&#20320;&#65292;&#20449;&#20214;&#27704;&#36960;&#19981;&#24517;&#21034;&#65281; - *
</I>&gt;<i> &gt; &#39340;&#19978;&#39636;&#39511;*
</I>&gt;<i> &gt;
</I>&gt;<i> &lt;<A HREF="http://tw.rd.yahoo.com/referurl/mail/mail20/tag_hot0103/*http://tw.mg0.mail.yahoo.com/dc/landing">http://tw.rd.yahoo.com/referurl/mail/mail20/tag_hot0103/*http://tw.mg0.mail.yahoo.com/dc/landing</A>&gt;
</I>&gt;<i> &gt; *&#65281;*
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ------------------------------------------------------------------------
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; OpenIMSCore-Users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>&gt;
</I>&gt;<i> &gt; <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> -----------------------------------------
</I>&gt;<i> Dipl.. Eng. Dragos Vingarzan
</I>&gt;<i> Fraunhofer FOKUS/NGNI
</I>&gt;<i> Kaiserin-Augusta-Allee 31
</I>&gt;<i> 10589 Berlin,Germany
</I>&gt;<i> Phone +49 (0)30 - 3463 - 7385
</I>&gt;<i> Mobile +49 (0)176 - 48 32 16 00
</I>&gt;<i> Web www.fokus.fraunhofer.de &lt;<A HREF="http://www.fokus.fraunhofer.de">http://www.fokus.fraunhofer.de</A>&gt;
</I>&gt;<i> www.openimscore.org &lt;<A HREF="http://www.openimscore.org">http://www.openimscore.org</A>&gt;
</I>&gt;<i> We could change the world if God would give us the source code...
</I>&gt;<i> -----------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#20184;&#36027;&#25165;&#23481;&#37327;&#28961;&#19978;&#38480;&#65311;Yahoo!&#22855;&#25705;&#38651;&#23376;&#20449;&#31665;2.0&#20813;&#36027;&#32102;&#20320;&#65292;&#20449;&#20214;&#27704;&#36960;&#19981;&#24517;&#21034;&#65281; - *
</I>&gt;<i> &#39340;&#19978;&#39636;&#39511;*
</I>&gt;<i> &lt;<A HREF="http://tw.rd.yahoo.com/referurl/mail/mail20/tag_hot0103/*http://tw.mg0.mail.yahoo.com/dc/landing">http://tw.rd.yahoo.com/referurl/mail/mail20/tag_hot0103/*http://tw.mg0.mail.yahoo.com/dc/landing</A>&gt;
</I>&gt;<i> *&#65281;*
</I>&gt;<i>
</I>

-- 
-----------------------------------------
Dipl. Eng. Dragos Vingarzan
Fraunhofer FOKUS/NGNI
Kaiserin-Augusta-Allee 31
10589 Berlin,Germany
Phone +49 (0)30 - 3463 - 7385
Mobile +49 (0)176 - 48 32 16 00
Web www.fokus.fraunhofer.de www.openimscore.org
We could change the world if God would give us the source code...
-----------------------------------------------------------------


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005430.html">[OpenIMSCore-Users] (no subject)
</A></li>
	<LI>Next message: <A HREF="005434.html">[OpenIMSCore-Users] ims with pstn
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5433">[ date ]</a>
              <a href="thread.html#5433">[ thread ]</a>
              <a href="subject.html#5433">[ subject ]</a>
              <a href="author.html#5433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
