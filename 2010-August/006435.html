<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] Problems with handling of &quot;480 Temporarily	unavailable&quot;
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2010-August/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Problems%20with%20handling%20of%20%22480%20Temporarily%0A%09unavailable%22&In-Reply-To=%3C76F1AEADAE0B47558452939AFC4BF1BC%40FranzEdlerPC%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006449.html">
   <LINK REL="Next"  HREF="006436.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] Problems with handling of &quot;480 Temporarily	unavailable&quot;</H1>
    <B>Franz Edler</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Problems%20with%20handling%20of%20%22480%20Temporarily%0A%09unavailable%22&In-Reply-To=%3C76F1AEADAE0B47558452939AFC4BF1BC%40FranzEdlerPC%3E"
       TITLE="[OpenIMSCore-Users] Problems with handling of &quot;480 Temporarily	unavailable&quot;">franz.edler at technikum-wien.at
       </A><BR>
    <I>Sun Aug 15 19:20:32 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="006449.html">[OpenIMSCore-Users] Why does I-CSCF not add the port-number	inVia header field?
</A></li>
        <LI>Next message: <A HREF="006436.html">[OpenIMSCore-Users] Trigger for out of network call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6435">[ date ]</a>
              <a href="thread.html#6435">[ thread ]</a>
              <a href="subject.html#6435">[ subject ]</a>
              <a href="author.html#6435">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

 

I found that the S-CSCF uses an incorrect response code in case user exists
but is not registered. 

The response generated by scscf.cfg in this case is &quot;404 Not Found -
destination user not found on this S-CSCF&quot;. This is not correct as this
response code is misleading.

 

According to 3GPP TS24.229 (&#167;5.4.3.3: Requests terminated at the served
user) the response code proposed is &quot;480 Temporarily unavailable&quot;. The
specific clause in that chapter says:

... When the S-CSCF receives, destined for an unregistered user, an initial
request for a dialog ...

...  

3) In case that no more AS needs to be contacted, then S-CSCF shall return
an appropriate unsuccessful SIP response. This response may be a 480
(Temporarily unavailable) and terminate these procedures. 

 

The other case of an unknown user is correctly handled by I-CSCF. After
receiving a diameter LIA with result-code: DIAMETER_ERROR_USER_UNKNOWN the
I-CSCF uses a SIP response &quot;604 Does not exist anywhere - HSS User Unknown&quot;.


 

For the &#147;480 Temporarily unavailable&#148; case I therefore propose to change the
response code in scscf.cfg in route[Term] as follows:

 

                if (!S_lookup()){

                        if (uri=~&quot;sip:(.*)@open-ims\.test(.*)&quot;) {

                                #if ( !t_newtran()) {

                                #       sl_reply_error();

                                #       exit;

                                #};                             

                                t_reply(&quot;404&quot;,&quot;Not Found - destination user
not found on this S-CSCF&quot;);

                                exit;

                        }               

                }

 

to 

                if (!S_lookup()){

                        if (uri=~&quot;sip:(.*)@open-ims\.test(.*)&quot;) {

                                #if ( !t_newtran()) {

                                #       sl_reply_error();

                                #       exit;

                                #};                             

                                t_reply(&quot;480&quot;,&quot;Temporarily unavailable&quot;);

                                exit;

                        }               

                }   

 

 

This modification works in principle but then weird things happen.

Now I-CSCF changes the response code &quot;480 Temporarily unavailable&quot; to &quot;600
Busy everywhere - Forwarding to S-CSCF failed&quot;.

 

I tried to understand the mechanism in
&quot;failure_route[Initial_Request_failure]&quot; where the response code 480 seems
to be handled, but have some problems to understand the difference between
I_scscf_select(&quot;0&quot;) and I_scscf_select(&quot;1&quot;).

 

Any help appreciated.

 

Franz

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openimscore-users/attachments/20100815/e5d97dbb/attachment.html">https://lists.berlios.de/pipermail/openimscore-users/attachments/20100815/e5d97dbb/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006449.html">[OpenIMSCore-Users] Why does I-CSCF not add the port-number	inVia header field?
</A></li>
	<LI>Next message: <A HREF="006436.html">[OpenIMSCore-Users] Trigger for out of network call
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6435">[ date ]</a>
              <a href="thread.html#6435">[ thread ]</a>
              <a href="subject.html#6435">[ subject ]</a>
              <a href="author.html#6435">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
