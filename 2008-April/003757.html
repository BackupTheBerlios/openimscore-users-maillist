<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] Strange behavior in pcscf - SIP Response 400	Bad Request - Not following indicated Service-Routes
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2008-April/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Strange%20behavior%20in%20pcscf%20-%20SIP%20Response%20400%0A%09Bad%20Request%20-%20Not%20following%20indicated%20Service-Routes&In-Reply-To=%3C5fd52d7a0804100428x13b83d5dm4a25e9afa4ca9648%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003756.html">
   <LINK REL="Next"  HREF="003761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] Strange behavior in pcscf - SIP Response 400	Bad Request - Not following indicated Service-Routes</H1>
    <B>Tomasz Zieleniewski</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Strange%20behavior%20in%20pcscf%20-%20SIP%20Response%20400%0A%09Bad%20Request%20-%20Not%20following%20indicated%20Service-Routes&In-Reply-To=%3C5fd52d7a0804100428x13b83d5dm4a25e9afa4ca9648%40mail.gmail.com%3E"
       TITLE="[OpenIMSCore-Users] Strange behavior in pcscf - SIP Response 400	Bad Request - Not following indicated Service-Routes">tzieleniewski at gmail.com
       </A><BR>
    <I>Thu Apr 10 13:28:14 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003756.html">[OpenIMSCore-Users] Adding Gq &amp; Rx libraries to Wireshark
</A></li>
        <LI>Next message: <A HREF="003761.html">[OpenIMSCore-Users] Strange behavior in pcscf - SIP Response 400	Bad Request - Not following indicated Service-Routes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3757">[ date ]</a>
              <a href="thread.html#3757">[ thread ]</a>
              <a href="subject.html#3757">[ subject ]</a>
              <a href="author.html#3757">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I am using &#65279;UCT IMS Client 1.0.9 as an IMS EU.
Client registers without any problem.
here is the request sent to pcscf:

REGISTER sip:ims.rd.touk.pl SIP/2.0
Via: SIP/2.0/UDP 192.168.0.192:5060;rport;branch=z9hG4bK510783691
Route: &lt;sip:ims.rd.touk.pl:4060;lr&gt;
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;&gt;;tag=1104733184
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">66616810 at 192.168.0.192</A>
CSeq: 2 REGISTER
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at 192.168.0.192</A>:5060&gt;
Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A>&quot;, realm=&quot;ims.rd.touk.pl&quot;,
nonce=&quot;gRLgx6iMwUCDLufeh91X57qumJwb5QAA0lkpl8X2ahc=&quot;, uri=&quot;sip:
ims.rd.touk.pl&quot;, response=&quot;487df357be95c3c909ac5c0b9bf6375f&quot;,
algorithm=AKAv1-MD5
Max-Forwards: 70
User-Agent: UCT IMS Client
Expires: 600000
Supported: path
Content-Length: 0

response from pcscf:
SIP/2.0 200 OK - SAR succesful and registrar saved
Via: SIP/2.0/UDP 192.168.0.192:5060;rport=5060;branch=z9hG4bK510783691
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;&gt;;tag=1104733184
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;
&gt;<i>;tag=8faef96b1375da908e80955f92b8834c-efd0
</I>Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">66616810 at 192.168.0.192</A>
CSeq: 2 REGISTER
P-Associated-URI: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;&gt;
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at 192.168.0.192</A>:5060&gt;;expires=600000
Path: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">term at pcscf.ims.rd.touk.pl</A>:4060;lr&gt;
Service-Route: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">orig at scscf.ims.rd.touk.pl</A>:6060;lr&gt;
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, MESSAGE,
INFO
P-Charging-Function-Addresses: ccf=pri_ccf_address
Server: Sip EXpress router (2.1.0-dev1 OpenIMSCore (x86_64/linux))
Content-Length: 0
Warning: 392 192.168.129.38:6060 &quot;Noisy feedback tells:  pid=2243
req_src_ip=192.168.129.38 req_src_port=5060 in_uri=sip:
scscf.ims.rd.touk.pl:6060 out_uri=sip:scscf.ims.rd.touk.pl:6060 via_cnt==3&quot;

According to 3gpp TS the UE shall build a proper preloaded Route header
value for all new dialogs and standalone transactions. The UE shall
build a list of Route header values made out of, in this order, the P-CSCF
URI (containing the IP address or the FQDN
learnt through the P-CSCF discovery procedures, and the protected server
port learnt during the registration procedure),
and the values received in the Service-Route header saved from the 200 (OK)
response to the last registration or re-
registration.

UCT IMS Client sends the following message:

MESSAGE sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">lkl at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Alkl at ims.rd.touk.pl</A>&gt; SIP/2.0
Via: SIP/2.0/UDP 192.168.0.192:5060;rport;branch=z9hG4bK2009699870
Route: &lt;sip:ims.rd.touk.pl:4060;lr&gt;
Route: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">orig at scscf.ims.rd.touk.pl</A>:6060;lr&gt;
From: &quot;PGR&quot; &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;
&gt;<i>;tag=1200053896
</I>To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">lkl at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Alkl at ims.rd.touk.pl</A>&gt;&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">482363788 at 192.168.0.192</A>
CSeq: 20 MESSAGE
Max-Forwards: 70
User-Agent: eXosip/2.2.2
P-Preferred-Identity: &quot;PGR&quot; &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A>&lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;
&gt;<i>
</I>P-Access-Network-Info: IEEE-802.11a
Content-Type: application/im-iscomposing+xml
Content-Length:   300

&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;isComposing xmlns=&quot;urn:ietf:params:xml:ns:im-iscomposing&quot;
xmlns:xsi=&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;
xsi:schemaLocation=&quot;urn:ietf:params:xml:ns:im-composing iscomposing.xsd&quot;&gt;
&lt;state&gt;active&lt;/state&gt;
&lt;contenttype&gt;text/plain&lt;/contenttype&gt;
&lt;/isComposing&gt;

and to this pcscf responses:
SIP/2.0 400 Bad Request - Not following indicated service routes
Via: SIP/2.0/UDP 192.168.0.192:5060;rport=5060;branch=z9hG4bK2009699870
From: &quot;PGR&quot; &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">pgr at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Apgr at ims.rd.touk.pl</A>&gt;
&gt;<i>;tag=1200053896
</I>To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">lkl at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Alkl at ims.rd.touk.pl</A>&gt;
&gt;<i>;tag=93fe602ab590f67e98d0b297122602c5.15ca
</I>Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">482363788 at 192.168.0.192</A>
CSeq: 20 MESSAGE
Server: Sip EXpress router (2.1.0-dev1 OpenIMSCore (x86_64/linux))
Content-Length: 0
Warning: 392 192.168.129.38:4060 &quot;Noisy feedback tells:  pid=21979
req_src_ip=192.168.0.192 req_src_port=5060
in_uri=sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">lkl at ims.rd.touk.pl</A>&lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Alkl at ims.rd.touk.pl</A>&gt;out_uri=
sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">lkl at ims.rd.touk.pl</A> &lt;sip%<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">3Alkl at ims.rd.touk.pl</A>&gt; via_cnt==1&quot;

UCT Client creates the Route list but with a different address of pcscf (no
user part not present) and shortened domain part.
This is error in UCT Client but I would like to make sure that it is and
does pcscf compares also the user part of the uri in the Route
header or only the domain one?

Have anyone had that issue before?

Thank you in advance.
Tomasz
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openimscore-users/attachments/20080410/3cfcfa52/attachment.html">https://lists.berlios.de/pipermail/openimscore-users/attachments/20080410/3cfcfa52/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003756.html">[OpenIMSCore-Users] Adding Gq &amp; Rx libraries to Wireshark
</A></li>
	<LI>Next message: <A HREF="003761.html">[OpenIMSCore-Users] Strange behavior in pcscf - SIP Response 400	Bad Request - Not following indicated Service-Routes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3757">[ date ]</a>
              <a href="thread.html#3757">[ thread ]</a>
              <a href="subject.html#3757">[ subject ]</a>
              <a href="author.html#3757">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
