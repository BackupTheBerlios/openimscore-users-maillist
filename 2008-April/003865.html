<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] Help needed on detailed authentication	procedure
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2008-April/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Help%20needed%20on%20detailed%20authentication%0A%09procedure&In-Reply-To=%3C9e02a1590804301346p6daab3adyd38b7c2b3364896a%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003860.html">
   <LINK REL="Next"  HREF="003866.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] Help needed on detailed authentication	procedure</H1>
    <B>Xuelin</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Help%20needed%20on%20detailed%20authentication%0A%09procedure&In-Reply-To=%3C9e02a1590804301346p6daab3adyd38b7c2b3364896a%40mail.gmail.com%3E"
       TITLE="[OpenIMSCore-Users] Help needed on detailed authentication	procedure">xuelinlin at gmail.com
       </A><BR>
    <I>Wed Apr 30 22:46:21 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003860.html">[OpenIMSCore-Users] Help needed on detailed authentication procedure
</A></li>
        <LI>Next message: <A HREF="003866.html">[OpenIMSCore-Users] Help needed on detailed	authentication	procedure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3865">[ date ]</a>
              <a href="thread.html#3865">[ thread ]</a>
              <a href="subject.html#3865">[ subject ]</a>
              <a href="author.html#3865">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mark,

Thanks for your reply.

The password I used is &quot;alice&quot;.  And based on RFC2617, I got the following:

&quot;A1       = unq(username-value) &quot;:&quot; unq(realm-value) &quot;:&quot; passwd &quot;

A1: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>:open-ims.test:alice
H(A1): a3da98c9b36dde1f17e3f713225dc4d1

&quot; A2       = Method &quot;:&quot; digest-uri-value &quot;

A2: REGISTER:sip:open-ims.test
H(A2): 556daf0ea7e51a561b0ea55f1bcae263

The nonce  is lZJoAoXoyuQyoaxHJMJEAJE06tzrMgAACehynTjMbi4=

&quot; If the &quot;qop&quot; directive is not present (this construction is for
   compatibility with RFC 2069):

      request-digest  =
                 &lt;&quot;&gt; &lt; KD ( H(A1), unq(nonce-value) &quot;:&quot; H(A2) ) &gt; &quot;

So in my case request-digest =
H[H(A1):nonce-value:H(A2])=d9f1a4be05cb523ec9c17c5f0814e7bc

I am wondering if it should be the response field in the following
message, apparently, the values are not match.

Request Register

Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&quot;,
realm=&quot;open-ims.test&quot;,
nonce=&quot;lZJoAoXoyuQyoaxHJMJEAJE06tzrMgAACehynTjMbi4=&quot;,
uri=&quot;sip:open-ims.test&quot;, response=&quot;610eb39ed4f73c74335979d3a41fb241&quot;,
algorithm=AKAv1-MD5

I noticed you wrote: In AKA-MD5 the password is the value RES
(RFC3310) which is calculated by the UE (TS 33.102). Maybe this is
where my problem is.Maybe the passwd field in &quot;A1       =
unq(username-value) &quot;:&quot; unq(realm-value) &quot;:&quot; passwd &quot; should not be
&quot;alice&quot; as I did but be the RES value calculated using K (alice) and
RAND by f2 in TS35.206 ?

If I am correct this time.The question here is that by TS35.206, the K
is a 128-bit subscriber key that is an input to the functions f1, f1*,
f2, f3, f4, f5 and f5*. But for me it is just &quot;alice&quot;.

In all, I am still confused what the &quot;passwd&quot; should be in RFC2617 and
how the response field is calculated out as in my case. By the way, do
you know if there is a web tool for me to do the f function in
TS35.206?

Thanks!

BR//Xuelin


On Tue, Apr 29, 2008 at 4:21 PM, Evans, Mark [CTO]
&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">Mark.X.Evans at sprint.com</A>&gt; wrote:
&gt;<i> Hi Xuelin
</I>&gt;<i>
</I>&gt;<i>  So here are my comments
</I>&gt;<i>
</I>&gt;<i>  1) The client should insert;
</I>&gt;<i>
</I>&gt;<i>  Nonce count (nc-value) in this case it should be 00000001 (first use of nonce)if it's not given then you can assume it has no content and omit it.
</I>&gt;<i>
</I>&gt;<i>  Cnonce (cnonce-value) this is a value generated by the UE if the UE is not generating cnonce then you can omit it. The UE will not generate a cnonce if it has not received a qop value.
</I>&gt;<i>
</I>&gt;<i>  2) The authenticator is supposed to provide qop (qop-value) servers should always provide qop, but again if it does not you can omit it. In this case the response must be calculated assuming qop=auth.
</I>&gt;<i>
</I>&gt;<i>  3) I suspect that the issue is the value of digest password you are using since you haven't mentioned it. In MD5 digest the digest password is the user password (i.e. the shared secret known by the UE and authenticator). In AKA-MD5 the password is the value RES (RFC3310) which is calculated by the UE (TS 33.102).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Mark
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   -----Original Message-----
</I>&gt;<i>   From: Xuelin [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">xuelinlin at gmail.com</A>]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Sent: Tuesday, April 29, 2008 12:29 PM
</I>&gt;<i>   To: Evans, Mark [CTO]
</I>&gt;<i>   Cc: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">franz.edler at inode.at</A>; <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>
</I>&gt;<i>   Subject: Re: [OpenIMSCore-Users] Help needed on detailed authentication
</I>&gt;<i>   procedure
</I>&gt;<i>
</I>&gt;<i>   Thank you all for your help. Now I can figure out A1, A2,  H(A1) and
</I>&gt;<i>   H(A2), but I can not find nc-value, cnonce-value and qop-value in my
</I>&gt;<i>   wireshark trace. Is that mean I just omit these field in the digest
</I>&gt;<i>   algrithm? I just tried to comput by myself, the response I got is not
</I>&gt;<i>   identical with response=&quot;610eb39ed4f73c74335979d3a41fb241&quot;.
</I>&gt;<i>
</I>&gt;<i>   Thanks!
</I>&gt;<i>
</I>&gt;<i>   BR//Xuelin
</I>&gt;<i>
</I>&gt;<i>   request-digest  = &lt;&quot;&gt; &lt; KD ( H(A1),     unq(nonce-value)
</I>&gt;<i>                                             &quot;:&quot; nc-value
</I>&gt;<i>                                             &quot;:&quot; unq(cnonce-value)
</I>&gt;<i>                                             &quot;:&quot; unq(qop-value)
</I>&gt;<i>                                             &quot;:&quot; H(A2)
</I>&gt;<i>                                     ) &lt;&quot;&gt;
</I>&gt;<i>
</I>&gt;<i>   401 unauthorized - Challenging the U
</I>&gt;<i>   WWW-Authenticate: Digest realm=&quot;open-ims.test&quot;,
</I>&gt;<i>   nonce=&quot;lZJoAoXoyuQyoaxHJMJEAJE06tzrMgAACehynTjMbi4=&quot;,
</I>&gt;<i>   algorithm=AKAv1-MD5, ck=&quot;6c04278d5abffd7b5549096f22729c6c&quot;,
</I>&gt;<i>   ik=&quot;ed4295656a44fbe0e86cc7a089c34101&quot;
</I>&gt;<i>
</I>&gt;<i>   Request Register
</I>&gt;<i>   Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&quot;,
</I>&gt;<i>   realm=&quot;open-ims.test&quot;,
</I>&gt;<i>   nonce=&quot;lZJoAoXoyuQyoaxHJMJEAJE06tzrMgAACehynTjMbi4=&quot;,
</I>&gt;<i>   uri=&quot;sip:open-ims.test&quot;, response=&quot;610eb39ed4f73c74335979d3a41fb241&quot;,
</I>&gt;<i>   algorithm=AKAv1-MD5
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   On Tue, Apr 29, 2008 at 11:02 AM, Evans, Mark [CTO]
</I>&gt;<i>   &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">Mark.X.Evans at sprint.com</A>&gt; wrote:
</I>&gt;<i>   &gt; Hi Xuelin,
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;  Here is some additional help on your questions
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;  #1 From RFC 3310 nonce=BASE64(RAND:AUTN). You need use base64 decode to
</I>&gt;<i>   get RAND:AUTN (i.e. concatenation of RAND and AUTN) from nonce.
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;  #3 See TS33.102
</I>&gt;<i>   &gt;  #4 See TS33.102. TS35.206 provides the definition of the functions f1 to
</I>&gt;<i>   f5
</I>&gt;<i>   &gt;  #5 See TS33.102. TS35.206 provides the definition of the functions f1 to
</I>&gt;<i>   f5
</I>&gt;<i>   &gt;  #6 From RFC3310 and RFC 2617 digest uri Is the request uri. So in the
</I>&gt;<i>   case
</I>&gt;<i>   &gt;  REGISTER sip:home.mobile.biz SIP/2.0 the digest uri is
</I>&gt;<i>   &quot;sip:home.mobile.biz&quot; and the method is REGISTER.
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;  In my opinion it qop=auth-int should never arise in the SIP REGISTER
</I>&gt;<i>   case because REGISTER message contains no body. If it is specified then the
</I>&gt;<i>   A2 value is the same in both cases, A2= Method &quot;:&quot; digest-uri-value because
</I>&gt;<i>   the body has zero length.
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;  Mark
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;   -----Original Message-----
</I>&gt;<i>   &gt;   From: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-bounces at lists.berlios.de</A> [mailto:openimscore-
</I>&gt;<i>   users-
</I>&gt;<i>   &gt;   <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bounces at lists.berlios.de</A>] On Behalf Of Franz Edler
</I>&gt;<i>   &gt;   Sent: Monday, April 28, 2008 9:56 PM
</I>&gt;<i>   &gt;   To: 'Xuelin'; <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>
</I>&gt;<i>   &gt;   Subject: Re: [OpenIMSCore-Users] Help needed on detailed authentication
</I>&gt;<i>   &gt;   procedure
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;   Hi Xuelin,
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;   &gt; Question #1: As of  RFC3310, nonce is base64 encoding of
</I>&gt;<i>   &gt;   &gt; RAND&amp;AUTN&amp;Server specific data. In this case, how do I know RAND&amp;AUTN
</I>&gt;<i>   &gt;   &gt; from nonce=&quot;lZJoAoXoyuQyoaxHJMJEAJE06tzrMgAACehynTjMbi4=&quot;?
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt; Question #2: Why there is no qop, cnonce and opaque field in 401
</I>&gt;<i>   &gt;   &gt; Unauthorized  message? As of RFC2617, these are needed for
</I>&gt;<i>   calculating
</I>&gt;<i>   &gt;   &gt; the digest.
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt; Question #3: Both the client and HSS need SQN. In this case, how
</I>&gt;<i>   could
</I>&gt;<i>   &gt;   &gt; I know SQN?
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt; Question #4: From RFC3310 page 4, I got that the HSS generates AV
</I>&gt;<i>   from
</I>&gt;<i>   &gt;   &gt; secret key (in this case, it is alice) and SQN. How could I know the
</I>&gt;<i>   &gt;   &gt; detailed procedure for doing that?
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt; Question #5: Similar to #4, client uses Key and SQN to verify AUTN,
</I>&gt;<i>   &gt;   &gt; need detailed procedure here.
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt; Question #6: The response=&quot;610eb39ed4f73c74335979d3a41fb241&quot; is
</I>&gt;<i>   &gt;   &gt; calculated using MD5 with Key and RAND. As of RFC2617,
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt;   request-digest  = &lt;&quot;&gt; &lt; KD ( H(A1),     unq(nonce-value)
</I>&gt;<i>   &gt;   &gt;                                           &quot;:&quot; nc-value
</I>&gt;<i>   &gt;   &gt;                                           &quot;:&quot; unq(cnonce-value)
</I>&gt;<i>   &gt;   &gt;                                           &quot;:&quot; unq(qop-value)
</I>&gt;<i>   &gt;   &gt;                                           &quot;:&quot; H(A2)
</I>&gt;<i>   &gt;   &gt;                                   ) &lt;&quot;&gt;
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt; Here    A2       = Method &quot;:&quot; digest-uri-value
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt;    If the &quot;qop&quot; value is &quot;auth-int&quot;, then A2 is:
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt;       A2       = Method &quot;:&quot; digest-uri-value &quot;:&quot; H(entity-body)
</I>&gt;<i>   &gt;   &gt;
</I>&gt;<i>   &gt;   &gt; My question is what are &quot;Method&quot; and  &quot;digest-uri-value&quot; in my case
</I>&gt;<i>   or
</I>&gt;<i>   &gt;   &gt; where I can find them?
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;   As a first quick answer I propose you should look into
</I>&gt;<i>   &gt;   - TS 33.102     3G Security architecture
</I>&gt;<i>   &gt;   - TS 33.203 Access security
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;   Regards
</I>&gt;<i>   &gt;   Franz
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;   _______________________________________________
</I>&gt;<i>   &gt;   OpenIMSCore-Users mailing list
</I>&gt;<i>   &gt;   <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>
</I>&gt;<i>   &gt;   <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;
</I>&gt;<i>   &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003860.html">[OpenIMSCore-Users] Help needed on detailed authentication procedure
</A></li>
	<LI>Next message: <A HREF="003866.html">[OpenIMSCore-Users] Help needed on detailed	authentication	procedure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3865">[ date ]</a>
              <a href="thread.html#3865">[ thread ]</a>
              <a href="subject.html#3865">[ subject ]</a>
              <a href="author.html#3865">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
