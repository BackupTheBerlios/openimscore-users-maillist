<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] Error establishing calls
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2006-November/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Error%20establishing%20calls&In-Reply-To=%3C456B2460.2050303%40fokus.fraunhofer.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000110.html">
   <LINK REL="Next"  HREF="000112.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] Error establishing calls</H1>
    <B>Dragos Vingarzan</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20Error%20establishing%20calls&In-Reply-To=%3C456B2460.2050303%40fokus.fraunhofer.de%3E"
       TITLE="[OpenIMSCore-Users] Error establishing calls">vingarzan at fokus.fraunhofer.de
       </A><BR>
    <I>Mon Nov 27 18:46:08 CET 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000110.html">[OpenIMSCore-Users] Error establishing calls
</A></li>
        <LI>Next message: <A HREF="000112.html">[OpenIMSCore-Users] [Feature #2908] Multiple &quot;Data-Reference&quot; AVPs	for UDR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111">[ date ]</a>
              <a href="thread.html#111">[ thread ]</a>
              <a href="subject.html#111">[ subject ]</a>
              <a href="author.html#111">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Andrej,

None that we know of for UE, but for simulation, SIPp is great. I have 
also contributed there AKA authentication some time ago.

-Dragos

Andrej Vrabel wrote:
&gt;<i> Hi,
</I>&gt;<i> is there any open source IMS client (or simulation) available?
</I>&gt;<i> Andrej
</I>&gt;<i>
</I>&gt;<i> Dragos Vingarzan wrote:
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> Hi Jose,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have just replied to Sebastian. It's the same issue. I have tried a 
</I>&gt;&gt;<i> fix, but I don't know...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is NOT a P-CSCF issue though. The whole SIP-to-IMS is a big hack. 
</I>&gt;&gt;<i> If anyone on the list wants to take up the task of rebuilding the 
</I>&gt;&gt;<i> SIP-to-IMS Gateway to work in B2B-UA mode, I will offer my support. 
</I>&gt;&gt;<i> Unfortunately there is no other easy way around the problem as you can 
</I>&gt;&gt;<i> not clearly identify the direction of the requests, nor that you 
</I>&gt;&gt;<i> should send it through the SIP2IMS Gateway.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The right and simple solution would be to use an IMS client.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -Dragos
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Jos&#233; Carlos Amorim wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> Hi, I&#8217;ve got openimscore running but when I try to make a call the 
</I>&gt;&gt;&gt;<i> Invites are not properly routed and the call isn&#8217;t established.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The problem is when the Invite reaches the P-cscf and is Mobile 
</I>&gt;&gt;&gt;<i> Terminated, the P-cscf relays the Invite to sip2ims but there is no 
</I>&gt;&gt;&gt;<i> Route Header indicating that it should relay to the sip2ims nor does 
</I>&gt;&gt;&gt;<i> the request URI indicates the IP of the sip2ims.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Can you explain what I am doing wrong?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I send in annex the capture and the log on the P-cscf for this Invite.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Jose Carlos Silva
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> OpenIMSCore-Users mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;&gt;&gt;<i>   
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> # $Id: sip2ims.cfg 6 2006-11-22 12:43:28Z vingarzan $
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> # SIP2IMS Gateway configuration script
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # ----------- global configuration parameters ------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> debug=3
</I>&gt;&gt;<i> log_stderror=yes
</I>&gt;&gt;<i> memlog=4
</I>&gt;&gt;<i> sip_warning=yes
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> fork=yes
</I>&gt;&gt;<i> children=4
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> listen=127.0.0.1
</I>&gt;&gt;<i> port=3060
</I>&gt;&gt;<i> alias=sip2ims.open-ims.test
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> check_via=no	# (cmd. line: -v)
</I>&gt;&gt;<i> dns=no			# (cmd. line: -r)
</I>&gt;&gt;<i> rev_dns=no		# (cmd. line: -R)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # ------------------ module loading ----------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Uncomment this if you want to use SQL database
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/mysql/mysql.so&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/sl/sl.so&quot;
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/tm/tm.so&quot;
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/maxfwd/maxfwd.so&quot;
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/textops/textops.so&quot;
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/auth/auth.so&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/auth_db/auth_db.so&quot;
</I>&gt;&gt;<i> modparam(&quot;auth_db&quot;,&quot;db_url&quot;,&quot;<A HREF="mysql://sip2ims:heslo@localhost/sip2ims">mysql://sip2ims:heslo@localhost/sip2ims</A>&quot;)
</I>&gt;&gt;<i> modparam(&quot;auth_db&quot;,&quot;use_did&quot;,0)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/rr/rr.so&quot;
</I>&gt;&gt;<i> modparam(&quot;rr&quot;, &quot;enable_full_lr&quot;, 1)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> loadmodule &quot;/opt/OpenIMSCore/ser_ims/modules/sip2ims/sip2ims.so&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> modparam(&quot;sip2ims&quot;,&quot;db_url&quot;,&quot;<A HREF="mysql://sip2ims:heslo@localhost/sip2ims">mysql://sip2ims:heslo@localhost/sip2ims</A>&quot;)
</I>&gt;&gt;<i> modparam(&quot;sip2ims&quot;,&quot;db_table&quot;,&quot;credentials&quot;)
</I>&gt;&gt;<i> #modparam(&quot;sip2ims&quot;,&quot;secret&quot;,&quot;alabala&quot;)
</I>&gt;&gt;<i> modparam(&quot;sip2ims&quot;,&quot;nonce_expire&quot;,300)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # -------------------------  request routing logic -------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # main routing logic
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> route{
</I>&gt;&gt;<i> 	
</I>&gt;&gt;<i> 	route(Sanity_Checks);
</I>&gt;&gt;<i> 	
</I>&gt;&gt;<i> #	if (uri==myself){
</I>&gt;&gt;<i> #		sl_send_reply(&quot;400&quot;,&quot;The SIP-to-IMS Gateway only works in proxy mode (no UAC/S)&quot;);
</I>&gt;&gt;<i> #		break;
</I>&gt;&gt;<i> #	}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	if (method==REGISTER){
</I>&gt;&gt;<i> 		route(REGISTER);
</I>&gt;&gt;<i> 	}
</I>&gt;&gt;<i> 	route(PCSCF);	
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> route[Sanity_Checks]
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> 	# initial sanity checks -- messages with
</I>&gt;&gt;<i> 	# max_forwards==0, or excessively long requests
</I>&gt;&gt;<i> 	if (!mf_process_maxfwd_header(&quot;11&quot;)) {
</I>&gt;&gt;<i> 		sl_send_reply(&quot;483&quot;,&quot;Too Many Hops&quot;);
</I>&gt;&gt;<i> 		exit;
</I>&gt;&gt;<i> 	};
</I>&gt;&gt;<i> 	if (msg:len &gt;=  max_len ) {
</I>&gt;&gt;<i> 		sl_send_reply(&quot;513&quot;, &quot;Message too big&quot;);
</I>&gt;&gt;<i> 		exit;
</I>&gt;&gt;<i> 	};
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> route[REGISTER]
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> 	if (www_authorize(&quot;open-ims.test&quot;,&quot;credentials&quot;)) {
</I>&gt;&gt;<i> 		if (!Gw_MD5_to_AKA(&quot;1&quot;)){
</I>&gt;&gt;<i> 			sl_send_reply(&quot;500&quot;,&quot;Error translating MD5-&gt;AKA authorized REGISTER&quot;);
</I>&gt;&gt;<i> 			exit;
</I>&gt;&gt;<i> 		}
</I>&gt;&gt;<i> 	}else{ 
</I>&gt;&gt;<i> 		if (!Gw_MD5_to_AKA(&quot;0&quot;)){
</I>&gt;&gt;<i> 			sl_send_reply(&quot;500&quot;,&quot;Error translating MD5-&gt;AKA unauthorized REGISTER&quot;);
</I>&gt;&gt;<i> 			exit;
</I>&gt;&gt;<i> 		}				
</I>&gt;&gt;<i> 	}
</I>&gt;&gt;<i> 	
</I>&gt;&gt;<i> 	t_on_reply(&quot;REGISTER_reply&quot;);
</I>&gt;&gt;<i> 	#t_on_failure(&quot;REGISTER_failure&quot;);
</I>&gt;&gt;<i> 	route(PCSCF);		
</I>&gt;&gt;<i> 	exit;
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> onreply_route[REGISTER_reply]
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i> 	if (t_check_status(&quot;401&quot;)){
</I>&gt;&gt;<i> 		if (!Gw_AKA_to_MD5()){
</I>&gt;&gt;<i> 			log(1,&quot;Error translating from AKA to MD5&quot;);
</I>&gt;&gt;<i> 			#sl_send_reply(&quot;500&quot;,&quot;Error translating AKA-&gt;MD5 challenge&quot;);
</I>&gt;&gt;<i> 			break;
</I>&gt;&gt;<i> 		}	
</I>&gt;&gt;<i> 	}	
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> route[PCSCF]
</I>&gt;&gt;<i> {
</I>&gt;&gt;<i>    if (method==&quot;INVITE&quot; ||method==&quot;SUBCRIBE&quot;){
</I>&gt;&gt;<i> 		record_route();
</I>&gt;&gt;<i> 	}
</I>&gt;&gt;<i> 	if (method==&quot;ACK&quot;||method==&quot;BYE&quot;||method==&quot;NOTIFY&quot;){
</I>&gt;&gt;<i> 		loose_route();
</I>&gt;&gt;<i> 		t_relay();
</I>&gt;&gt;<i> 		exit;
</I>&gt;&gt;<i> 	}
</I>&gt;&gt;<i> 	loose_route();
</I>&gt;&gt;<i> 	if (!search(&quot;.*sip:127.0.0.1:3060.*&quot;)||method==&quot;REGISTER&quot;) {
</I>&gt;&gt;<i> 		if (!t_relay_to_udp(&quot;127.0.0.1&quot;,&quot;4060&quot;)) {
</I>&gt;&gt;<i> 		    sl_send_reply(&quot;500&quot;,&quot;Error forwarding to P-CSCF&quot;);
</I>&gt;&gt;<i> 		}
</I>&gt;&gt;<i> 	} else {
</I>&gt;&gt;<i> 	    if (!t_relay()) {
</I>&gt;&gt;<i>    	     sl_reply_error();
</I>&gt;&gt;<i>    	}
</I>&gt;&gt;<i>    }
</I>&gt;&gt;<i>    exit;
</I>&gt;&gt;<i> }
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> OpenIMSCore-Users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>   
</I>

-- 
-----------------------------------------
Dipl. Eng. Dragos Vingarzan
FOKUS/NGNI
Kaiserin-Augusta-Allee 31
10589 Berlin,Germany
Phone +49 (0)30 - 3463 - 7385
Mobile +49 (0)163 - 159 - 5221
eMail <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">vingarzan at fokus.fraunhofer.de</A>
Web www.fokus.fraunhofer.de
We could change the world if God would give us the source code...
-----------------------------------------------------------------


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000110.html">[OpenIMSCore-Users] Error establishing calls
</A></li>
	<LI>Next message: <A HREF="000112.html">[OpenIMSCore-Users] [Feature #2908] Multiple &quot;Data-Reference&quot; AVPs	for UDR
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#111">[ date ]</a>
              <a href="thread.html#111">[ thread ]</a>
              <a href="subject.html#111">[ subject ]</a>
              <a href="author.html#111">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
