<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20OpenIMSCore-Users%20Digest%2C%20Vol%2035%2C%20Issue%2023&In-Reply-To=%3C1253711416.2566.172.camel%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005781.html">
   <LINK REL="Next"  HREF="005782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23</H1>
    <B>sunil</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20OpenIMSCore-Users%20Digest%2C%20Vol%2035%2C%20Issue%2023&In-Reply-To=%3C1253711416.2566.172.camel%40localhost.localdomain%3E"
       TITLE="[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23">sunil.p at globaledgesoft.com
       </A><BR>
    <I>Wed Sep 23 15:10:16 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005781.html">[OpenIMSCore-Users] Registration over IPSec in TCP Fails
</A></li>
        <LI>Next message: <A HREF="005782.html">[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5777">[ date ]</a>
              <a href="thread.html#5777">[ thread ]</a>
              <a href="subject.html#5777">[ subject ]</a>
              <a href="author.html#5777">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,
            We have done few changes in the security.c file
(Path:OpenIMSCore/ser_ims/modules/pcscf) .After doing the changes
            Registration over IPSec in TCP is successful.
                
            We have modified the code to create all the 4 SAs while
processing 401 response(Function name:P_security_401) and 
            also we have commented the code to Create SAs while
processing 200 response(Function name:P_security_200) .

            Please search for the &quot; FIX by Global Edge Software Limited&quot;
in the attached file for the changes.
                
            Please assert that this fix is valid and if possible
release a patch with this Fix.

Regards,
Sunil

 
         
           


On Wed, 2009-09-23 at 12:04 +0200,
<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-request at lists.berlios.de</A> wrote:

&gt;<i> Send OpenIMSCore-Users mailing list submissions to
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>
</I>&gt;<i> 
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-request at lists.berlios.de</A>
</I>&gt;<i> 
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-owner at lists.berlios.de</A>
</I>&gt;<i> 
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of OpenIMSCore-Users digest...&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Today's Topics:
</I>&gt;<i> 
</I>&gt;<i>    1. Registration over IPSec in TCP Fails (sunil)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Wed, 23 Sep 2009 11:53:34 +0530
</I>&gt;<i> From: sunil &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">sunil.p at globaledgesoft.com</A>&gt;
</I>&gt;<i> Subject: [OpenIMSCore-Users] Registration over IPSec in TCP Fails
</I>&gt;<i> To: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>
</I>&gt;<i> Message-ID: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">1253687014.2566.114.camel at localhost.localdomain</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi All,
</I>&gt;<i>             
</I>&gt;<i>             We are unable to register user using TCP in IPSec.We are
</I>&gt;<i> using OpenIMSCore Revision 680.
</I>&gt;<i>             Below is the call flow for Registration using TCP
</I>&gt;<i> 
</I>&gt;<i>                Registration in TCP call flow :
</I>&gt;<i>                             Register(unprotected)
</I>&gt;<i>                     -------------------------------&gt;  
</I>&gt;<i> 
</I>&gt;<i>                                 401(Unprotected)                
</I>&gt;<i>                     &lt;--------------------------------
</I>&gt;<i>         
</I>&gt;<i>                               syn in esp(for establishing tcp connection
</I>&gt;<i> using protected ports i.e uc and ps port)
</I>&gt;<i>                     ----------------------------------&gt;
</I>&gt;<i> 
</I>&gt;<i>                                 syn,ack in esp
</I>&gt;<i>                     &lt;----------------------------------        
</I>&gt;<i> 
</I>&gt;<i>                                 ack in esp
</I>&gt;<i>                     ------------------------------------&gt;
</I>&gt;<i> 
</I>&gt;<i>                                 Register  in esp
</I>&gt;<i>                     --------------------------------------&gt;    
</I>&gt;<i> 
</I>&gt;<i>                                     200 OK in esp
</I>&gt;<i>                    &lt;---------------------------------------     
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The problem we are facing is when p-cscf sends 401 response it is
</I>&gt;<i> creating only single SA(i.e for receiving packets from Uc pport to Ps
</I>&gt;<i> port) instead of Creating two new pairs of SAs in the local security
</I>&gt;<i> association database.Because of this reason it is sending the syn,ack
</I>&gt;<i> packets (for establishing TCP connection) in unprotected mode(using
</I>&gt;<i> src_port = Ps and dest_port =Uc).And Since we have already created two
</I>&gt;<i> new pairs of SAs on our side after receiving 401 response we are
</I>&gt;<i> rejecting this packet as Unprotected messages should not be received  on
</I>&gt;<i> Protected Ports.
</I>&gt;<i> 
</I>&gt;<i> As per our analysis we found out that P-CSCF  is creating only single
</I>&gt;<i> SA(i.e for receiving packets from Uc pport to Ps port) before sending
</I>&gt;<i> 401.
</I>&gt;<i> It is creating the remaining SAs only after we send another register
</I>&gt;<i> message in esp for 401 response received.
</I>&gt;<i> 
</I>&gt;<i> Also NOTE  that we were able to successfully register in UDP using
</I>&gt;<i> IPSec.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thanks and Regards,
</I>&gt;<i> Sunil 
</I>&gt;<i> 
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> URL: <A HREF="https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/e9626c6d/attachment-0001.html">https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/e9626c6d/attachment-0001.html</A> 
</I>&gt;<i> 
</I>&gt;<i> ------------------------------
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> OpenIMSCore-Users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> End of OpenIMSCore-Users Digest, Vol 35, Issue 23
</I>&gt;<i> *************************************************
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/c30b3b01/attachment.html">https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/c30b3b01/attachment.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: security.c
Type: text/x-csrc
Size: 45312 bytes
Desc: not available
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/c30b3b01/attachment.c">https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/c30b3b01/attachment.c</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005781.html">[OpenIMSCore-Users] Registration over IPSec in TCP Fails
</A></li>
	<LI>Next message: <A HREF="005782.html">[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5777">[ date ]</a>
              <a href="thread.html#5777">[ thread ]</a>
              <a href="subject.html#5777">[ subject ]</a>
              <a href="author.html#5777">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
