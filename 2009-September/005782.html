<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2009-September/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20OpenIMSCore-Users%20Digest%2C%20Vol%2035%2C%20Issue%2023&In-Reply-To=%3C4ABB4A2F.3080309%40fokus.fraunhofer.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005777.html">
   <LINK REL="Next"  HREF="005778.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23</H1>
    <B>Dragos Vingarzan</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20OpenIMSCore-Users%20Digest%2C%20Vol%2035%2C%20Issue%2023&In-Reply-To=%3C4ABB4A2F.3080309%40fokus.fraunhofer.de%3E"
       TITLE="[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23">Dragos.Vingarzan at fokus.fraunhofer.de
       </A><BR>
    <I>Thu Sep 24 12:30:07 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005777.html">[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23
</A></li>
        <LI>Next message: <A HREF="005778.html">[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 24
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5782">[ date ]</a>
              <a href="thread.html#5782">[ thread ]</a>
              <a href="subject.html#5782">[ subject ]</a>
              <a href="author.html#5782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Sunil,

thank you for the contribution! But now I will ask for a bit more ;-).

Like I said in my previous mail, there are DoS concerns with the 
establishment of the SAs and as such I would agree more on a solution 
that sets only the required SAs when they are needed. And I guess you 
only need one more SA on 401, right?

Then your security.c seems to be from an older revision of 
ser_ims/trunk. Could you please do an update, re-apply your patch on the 
new file, check if it still works OK and then send me just the diff? 
(svn diff &gt;security.patch).

Thanx&amp;Cheers,
-Dragos


sunil wrote:
&gt;<i> Hi All,
</I>&gt;<i>             We have done few changes in the security.c file 
</I>&gt;<i> (Path:OpenIMSCore/ser_ims/modules/pcscf) .After doing the changes
</I>&gt;<i>             Registration over IPSec in TCP is successful.
</I>&gt;<i>                
</I>&gt;<i>             We have modified the code to create all the 4 SAs while 
</I>&gt;<i> processing 401 response(Function name:P_security_401) and
</I>&gt;<i>             also we have commented the code to Create SAs while 
</I>&gt;<i> processing 200 response(Function name:P_security_200) .
</I>&gt;<i>
</I>&gt;<i>             Please search for the &quot; FIX by Global Edge Software 
</I>&gt;<i> Limited&quot; in the attached file for the changes.
</I>&gt;<i>                
</I>&gt;<i>             Please assert that this fix is valid and if possible  
</I>&gt;<i> release a patch with this Fix.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Sunil
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>         
</I>&gt;<i>           
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Wed, 2009-09-23 at 12:04 +0200, 
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-request at lists.berlios.de</A> wrote:
</I>&gt;&gt;<i> Send OpenIMSCore-Users mailing list submissions to
</I>&gt;&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-request at lists.berlios.de</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-request at lists.berlios.de</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can reach the person managing the list at
</I>&gt;&gt;<i> 	<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-owner at lists.berlios.de</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users-owner at lists.berlios.de</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;&gt;<i> than &quot;Re: Contents of OpenIMSCore-Users digest...&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Today's Topics:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    1. Registration over IPSec in TCP Fails (sunil)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Message: 1
</I>&gt;&gt;<i> Date: Wed, 23 Sep 2009 11:53:34 +0530
</I>&gt;&gt;<i> From: sunil &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">sunil.p at globaledgesoft.com</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">sunil.p at globaledgesoft.com</A>&gt;&gt;
</I>&gt;&gt;<i> Subject: [OpenIMSCore-Users] Registration over IPSec in TCP Fails
</I>&gt;&gt;<i> To: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>&gt;
</I>&gt;&gt;<i> Message-ID: &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">1253687014.2566.114.camel at localhost.localdomain</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">1253687014.2566.114.camel at localhost.localdomain</A>&gt;&gt;
</I>&gt;&gt;<i> Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi All,
</I>&gt;&gt;<i>             
</I>&gt;&gt;<i>             We are unable to register user using TCP in IPSec.We are
</I>&gt;&gt;<i> using OpenIMSCore Revision 680.
</I>&gt;&gt;<i>             Below is the call flow for Registration using TCP
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                Registration in TCP call flow :
</I>&gt;&gt;<i>                             Register(unprotected)
</I>&gt;&gt;<i>                     -------------------------------&gt;  
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                 401(Unprotected)                
</I>&gt;&gt;<i>                     &lt;--------------------------------
</I>&gt;&gt;<i>         
</I>&gt;&gt;<i>                               syn in esp(for establishing tcp connection
</I>&gt;&gt;<i> using protected ports i.e uc and ps port)
</I>&gt;&gt;<i>                     ----------------------------------&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                 syn,ack in esp
</I>&gt;&gt;<i>                     &lt;----------------------------------        
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                 ack in esp
</I>&gt;&gt;<i>                     ------------------------------------&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                 Register  in esp
</I>&gt;&gt;<i>                     --------------------------------------&gt;    
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                                     200 OK in esp
</I>&gt;&gt;<i>                    &lt;---------------------------------------     
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The problem we are facing is when p-cscf sends 401 response it is
</I>&gt;&gt;<i> creating only single SA(i.e for receiving packets from Uc pport to Ps
</I>&gt;&gt;<i> port) instead of Creating two new pairs of SAs in the local security
</I>&gt;&gt;<i> association database.Because of this reason it is sending the syn,ack
</I>&gt;&gt;<i> packets (for establishing TCP connection) in unprotected mode(using
</I>&gt;&gt;<i> src_port = Ps and dest_port =Uc).And Since we have already created two
</I>&gt;&gt;<i> new pairs of SAs on our side after receiving 401 response we are
</I>&gt;&gt;<i> rejecting this packet as Unprotected messages should not be received  on
</I>&gt;&gt;<i> Protected Ports.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As per our analysis we found out that P-CSCF  is creating only single
</I>&gt;&gt;<i> SA(i.e for receiving packets from Uc pport to Ps port) before sending
</I>&gt;&gt;<i> 401.
</I>&gt;&gt;<i> It is creating the remaining SAs only after we send another register
</I>&gt;&gt;<i> message in esp for 401 response received.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Also NOTE  that we were able to successfully register in UDP using
</I>&gt;&gt;<i> IPSec.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks and Regards,
</I>&gt;&gt;<i> Sunil 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -------------- next part --------------
</I>&gt;&gt;<i> An HTML attachment was scrubbed...
</I>&gt;&gt;<i> URL: <A HREF="https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/e9626c6d/attachment-0001.html">https://lists.berlios.de/pipermail/openimscore-users/attachments/20090923/e9626c6d/attachment-0001.html</A> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> OpenIMSCore-Users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A> &lt;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> End of OpenIMSCore-Users Digest, Vol 35, Issue 23
</I>&gt;&gt;<i> *************************************************
</I>&gt;&gt;<i>     
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> OpenIMSCore-Users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>

-- 
-----------------------------------------
Dipl. Eng. Dragos Vingarzan
Fraunhofer FOKUS/NGNI
Kaiserin-Augusta-Allee 31
10589 Berlin,Germany
Phone +49 (0)30 - 3463 - 7385
Mobile +49 (0)176 - 48 32 16 00
Web www.fokus.fraunhofer.de www.openimscore.org
We could change the world if God would give us the source code...
-----------------------------------------------------------------


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005777.html">[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 23
</A></li>
	<LI>Next message: <A HREF="005778.html">[OpenIMSCore-Users] OpenIMSCore-Users Digest, Vol 35, Issue 24
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5782">[ date ]</a>
              <a href="thread.html#5782">[ thread ]</a>
              <a href="subject.html#5782">[ subject ]</a>
              <a href="author.html#5782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
