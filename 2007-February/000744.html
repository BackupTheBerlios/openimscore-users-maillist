<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] SIP deregistration with strange	&quot;Expires&quot;-header
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20SIP%20deregistration%20with%20strange%0A%09%22Expires%22-header&In-Reply-To=%3CDAE692177CCBC94C807D3445E6A0CEC2018C7CB3%40taxis.buc.materna.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000698.html">
   <LINK REL="Next"  HREF="000872.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] SIP deregistration with strange	&quot;Expires&quot;-header</H1>
    <B>Sven.Bornemann at materna.de</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20SIP%20deregistration%20with%20strange%0A%09%22Expires%22-header&In-Reply-To=%3CDAE692177CCBC94C807D3445E6A0CEC2018C7CB3%40taxis.buc.materna.com%3E"
       TITLE="[OpenIMSCore-Users] SIP deregistration with strange	&quot;Expires&quot;-header">Sven.Bornemann at materna.de
       </A><BR>
    <I>Thu Feb  8 18:08:58 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000698.html">[OpenIMSCore-Users] SIP deregistration with strange	&quot;Expires&quot;-header
</A></li>
        <LI>Next message: <A HREF="000872.html">[OpenIMSCore-Users] SIP deregistration with	strange&quot;Expires&quot;-header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#744">[ date ]</a>
              <a href="thread.html#744">[ thread ]</a>
              <a href="subject.html#744">[ subject ]</a>
              <a href="author.html#744">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Dragos!
I forgot to tell you, that X-Lite sent &quot;expires=0&quot; as Contact
header attribute instead of a separate Expires header on SIP 
deregistration.

Session Initiation Protocol
    Request-Line: REGISTER sip:open-ims.test SIP/2.0
    Message Header
        Via: SIP/2.0/UDP 139.2.245.134:27904;branch=z9hG4bK-d87543-950c512ed9753d38-1--d87543-;rport
        Max-Forwards: 70
        Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at 139.2.245.134</A>:27904;rinstance=65bcef4f23404a17&gt;;expires=0
        To: &quot;alice&quot;&lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;
        From: &quot;alice&quot;&lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;;tag=21353e66
        Call-ID: NTkyZDk4NTU0ZTg4MGNjNmVjNWMxMzRkZTZhMGQ1ZjE.
        CSeq: 3 REGISTER
        Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY, MESSAGE, SUBSCRIBE, INFO
        User-Agent: X-Lite release 1006e stamp 34025
        Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&quot;,realm=&quot;open-ims.test&quot;,nonce=&quot;45cb5904b06e7cfa36c882f44d695a133e6d8c3b&quot;,uri=&quot;sip:open-ims.test&quot;,response=&quot;59aad5dc705be5656c1e061f3d8c3c2b&quot;,algorithm=MD5,opaque=&quot;AKAv1-MD5HF/x6NKgvgfBZb
        Content-Length: 0


And that should also be o.k. as mentioned in to RFC 3261:

------------------snip------------------

10.2.1.1 Setting the Expiration Interval of Contact Addresses

   When a client sends a REGISTER request, it MAY suggest an expiration
   interval that indicates how long the client would like the
   registration to be valid.  (As described in Section 10.3, the
   registrar selects the actual time interval based on its local
   policy.)

   There are two ways in which a client can suggest an expiration
   interval for a binding: through an Expires header field or an
   &quot;expires&quot; Contact header parameter.  The latter allows expiration
   intervals to be suggested on a per-binding basis when more than one
   binding is given in a single REGISTER request, whereas the former
   suggests an expiration interval for all Contact header field values
   that do not contain the &quot;expires&quot; parameter.

------------------snap------------------

Dragos, what is your opinion?

Bye,
Sven

&gt;<i> -----Urspr&#252;ngliche Nachricht-----
</I>&gt;<i> Von: Dragos Vingarzan [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">vingarzan at fokus.fraunhofer.de</A>]
</I>&gt;<i> Gesendet: Mittwoch, 7. Februar 2007 11:39
</I>&gt;<i> An: Bornemann, Sven
</I>&gt;<i> Cc: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">openimscore-users at lists.berlios.de</A>
</I>&gt;<i> Betreff: Re: [OpenIMSCore-Users] SIP deregistration with strange
</I>&gt;<i> &quot;Expires&quot;-header
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Hi Sven,
</I>&gt;<i> 
</I>&gt;<i> so the additional &quot;120&quot; seconds is there so that the expiration on the
</I>&gt;<i> AS would be at a later time than on the S-CSCF. You can 
</I>&gt;<i> change this from
</I>&gt;<i> the scscf.cfg as we have exported it as a parameter:
</I>&gt;<i> 
</I>&gt;<i> modparam(&quot;isc&quot;,&quot;expires_grace&quot;,120)
</I>&gt;<i> 
</I>&gt;<i> For the 2nd part, I think that the S-CSCF can not determine a clear
</I>&gt;<i> de-registration as there is no Expires: 0 header as there 
</I>&gt;<i> should be. So
</I>&gt;<i> it thinks it is a re-registration and gets the expiration 
</I>&gt;<i> time from the
</I>&gt;<i> registrar, and I guess in your case there were 3005 seconds left + 120
</I>&gt;<i> graced.
</I>&gt;<i> 
</I>&gt;<i> -Dragos
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">Sven.Bornemann at materna.de</A> wrote:
</I>&gt;<i> &gt; Hi all!
</I>&gt;<i> &gt; Our AS intercepts SIP REGISTER messages sent by S-CSCF in order to
</I>&gt;<i> &gt; detect the SIP client registration state (registered/deregistered).
</I>&gt;<i> &gt; The original - by X-Lite sent - expiry time (3600 seconds) 
</I>&gt;<i> will always be 
</I>&gt;<i> &gt; increased by 120s to 3720s (-&gt; Expires: 3720)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; REGISTER sip:192.168.38.131:5070 SIP/2.0
</I>&gt;<i> &gt; Via: SIP/2.0/UDP 192.168.38.131:6060;branch=z9hG4bK5704.fde0a342.0
</I>&gt;<i> &gt; To: sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>
</I>&gt;<i> &gt; From: 
</I>&gt;<i> sip:scscf.open-ims.test:6060;tag=4c985cfd8cad9767c3c3ed1e493a07b9-15a9
</I>&gt;<i> &gt; CSeq: 10 REGISTER
</I>&gt;<i> &gt; Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">7e39adce-23299 at 192.168.38.131</A>
</I>&gt;<i> &gt; User-Agent: Sip EXpress router(0.10.99-dev53-tm_fixes (i386/linux))
</I>&gt;<i> &gt; Event: registration
</I>&gt;<i> &gt; Content-Length: 0
</I>&gt;<i> &gt; Max-Forwards: 10
</I>&gt;<i> &gt; Expires: 3720
</I>&gt;<i> &gt; Contact: &lt;sip:scscf.open-ims.test:6060&gt;
</I>&gt;<i> &gt; P-Charging-Vector: icid-value=&quot;abcd45c9977f000002aa&quot;; 
</I>&gt;<i> icid-generated-at=&quot;192.168.38.131&quot;; orig-ioi=&quot;open-ims.test&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That not a big problem, but the subsequent deregistration 
</I>&gt;<i> received by the AS
</I>&gt;<i> &gt; still contains a Expiry header, but with a value &gt; 0 
</I>&gt;<i> (inital value - interval the
</I>&gt;<i> &gt; client was registered -&gt; Expires: 3125). The original 
</I>&gt;<i> REGISTER message, received
</I>&gt;<i> &gt; by the SIP2IMS GW, contains no &quot;Expires&quot;-header.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; recv 579 bytes from udp/[192.168.38.131]:6060 at 09:20:18.557611:
</I>&gt;<i> &gt; REGISTER sip:192.168.38.131:5070 SIP/2.0
</I>&gt;<i> &gt; Via: SIP/2.0/UDP 192.168.38.131:6060;branch=z9hG4bK6704.6c5c1d15.0
</I>&gt;<i> &gt; To: sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>
</I>&gt;<i> &gt; From: 
</I>&gt;<i> sip:scscf.open-ims.test:6060;tag=4c985cfd8cad9767c3c3ed1e493a07b9-7a96
</I>&gt;<i> &gt; CSeq: 10 REGISTER
</I>&gt;<i> &gt; Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">7e39adcf-23299 at 192.168.38.131</A>
</I>&gt;<i> &gt; User-Agent: Sip EXpress router(0.10.99-dev53-tm_fixes (i386/linux))
</I>&gt;<i> &gt; Event: registration
</I>&gt;<i> &gt; Content-Length: 0
</I>&gt;<i> &gt; Max-Forwards: 10
</I>&gt;<i> &gt; Expires: 3125
</I>&gt;<i> &gt; Contact: &lt;sip:scscf.open-ims.test:6060&gt;
</I>&gt;<i> &gt; P-Charging-Vector: icid-value=&quot;abcd45c999d2000002b3&quot;; 
</I>&gt;<i> icid-generated-at=&quot;192.168.38.131&quot;; orig-ioi=&quot;open-ims.test&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; We would expect no &quot;Expires&quot;-header or at least a value of 
</I>&gt;<i> 0 for that.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What is the reason for this behaviour? A bug?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Thanks in advance,
</I>&gt;<i> &gt; Sven
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; OpenIMSCore-Users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">OpenIMSCore-Users at lists.berlios.de</A>
</I>&gt;<i> &gt; <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">https://lists.berlios.de/mailman/listinfo/openimscore-users</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> -----------------------------------------
</I>&gt;<i> Dipl. Eng. Dragos Vingarzan
</I>&gt;<i> FOKUS/NGNI
</I>&gt;<i> Kaiserin-Augusta-Allee 31
</I>&gt;<i> 10589 Berlin,Germany
</I>&gt;<i> Phone +49 (0)30 - 3463 - 7385
</I>&gt;<i> Mobile +49 (0)163 - 159 - 5221
</I>&gt;<i> eMail <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">vingarzan at fokus.fraunhofer.de</A>
</I>&gt;<i> Web www.fokus.fraunhofer.de
</I>&gt;<i> We could change the world if God would give us the source code...
</I>&gt;<i> -----------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000698.html">[OpenIMSCore-Users] SIP deregistration with strange	&quot;Expires&quot;-header
</A></li>
	<LI>Next message: <A HREF="000872.html">[OpenIMSCore-Users] SIP deregistration with	strange&quot;Expires&quot;-header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#744">[ date ]</a>
              <a href="thread.html#744">[ thread ]</a>
              <a href="subject.html#744">[ subject ]</a>
              <a href="author.html#744">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
