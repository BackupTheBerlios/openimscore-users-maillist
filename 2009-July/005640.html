<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OpenIMSCore-Users] P-CSCF got segfault while Forwarding INVITE	received in TLS.
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openimscore-users/2009-July/index.html" >
   <LINK REL="made" HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20P-CSCF%20got%20segfault%20while%20Forwarding%20INVITE%0A%09received%20in%20TLS.&In-Reply-To=%3C4A6C718D.4020309%40globaledgesoft.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005651.html">
   <LINK REL="Next"  HREF="005641.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OpenIMSCore-Users] P-CSCF got segfault while Forwarding INVITE	received in TLS.</H1>
    <B>prashanth.me</B> 
    <A HREF="mailto:openimscore-users%40lists.berlios.de?Subject=Re%3A%20%5BOpenIMSCore-Users%5D%20P-CSCF%20got%20segfault%20while%20Forwarding%20INVITE%0A%09received%20in%20TLS.&In-Reply-To=%3C4A6C718D.4020309%40globaledgesoft.com%3E"
       TITLE="[OpenIMSCore-Users] P-CSCF got segfault while Forwarding INVITE	received in TLS.">prashanth.me at globaledgesoft.com
       </A><BR>
    <I>Sun Jul 26 17:09:01 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="005651.html">[OpenIMSCore-Users] I-CSCF rejecting REGISTER with 600	Busy	everywhere
</A></li>
        <LI>Next message: <A HREF="005641.html">[OpenIMSCore-Users] Trigger-point matches where it should not
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5640">[ date ]</a>
              <a href="thread.html#5640">[ thread ]</a>
              <a href="subject.html#5640">[ subject ]</a>
              <a href="author.html#5640">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All,

After successful registration in TLS, when a INVITE is sent to P-CSCF in 
TLS,
calling party received 100 trying but P-CSCF got segmentation fault.
By analyzing the the core file, it seems that P-CSCF got segfault while 
forwarding the INVITE to callee
(who has registered in TLS).
Log Message Printed: 4(12942) get_send_socket: force_send_socket of 
different proto (1)!

Along with gdb trace,  Registration procedure of both caller and callee 
and a INVITE message is provided below.
is there any problem in INVITE Message?
Please help us to resolve this issue.

--------------------------------------        gdb Trace 
-----------------------------------------------------------------------
Core was generated by `/opt/OpenIMSCore/ser_ims/ser -f 
/opt/OpenIMSCore/pcscf.cfg -D -D'.
Program terminated with signal 11, Segmentation fault.
#0  get_send_socket (msg=0x81c0c38, to=0xb623296c, proto=1) at forward.c:172
172                             if (msg-&gt;force_send_socket-&gt;socket==-1)
(gdb) p msg-&gt;force_send_socket
$1 = (struct socket_info *) 0x0
(gdb) bt
#0  get_send_socket (msg=0x81c0c38, to=0xb623296c, proto=1) at forward.c:172
#1  0x00138e2c in add_uac (t=0xb6232864, request=0x81c0c38, 
uri=0x81c0c54, next_hop=0x81c0d8c, proxy=0x0, proto=0)
    at ut.h:308
#2  0x0013af05 in t_forward_nonack (t=0xb6232864, p_msg=0x81c0c38, 
proxy=0x0, proto=0) at t_fwd.c:765
#3  0x001355c2 in t_relay_to (p_msg=0x81c0c38, proxy=0x0, proto=0, 
replicate=0) at t_funcs.c:285
#4  0x00144360 in w_t_relay (p_msg=0x81c0c38, _foo=0x0, _bar=0x0) at 
tm.c:1121
#5  0x08052063 in do_action (a=0x81b7364, msg=0x81c0c38) at action.c:681
#6  0x08054a7b in run_actions (a=0x81b7364, msg=0x81c0c38) at action.c:920
#7  0x0809f5b6 in eval_expr (e=0x81b73d0, msg=0x81c0c38) at route.c:1050
#8  0x0809f39f in eval_expr (e=0x81b7420, msg=0x81c0c38) at route.c:1170
#9  0x08051e1f in do_action (a=0x81b7924, msg=0x81c0c38) at action.c:652
#10 0x08054a7b in run_actions (a=0x81b5e70, msg=0x81c0c38) at action.c:920
#11 0x08051d1a in do_action (a=0x819d010, msg=0x81c0c38) at action.c:439
#12 0x08054a7b in run_actions (a=0x819d010, msg=0x81c0c38) at action.c:920
#13 0x08054440 in do_action (a=0x819e498, msg=0x81c0c38) at action.c:672
#14 0x08054a7b in run_actions (a=0x819e498, msg=0x81c0c38) at action.c:920
#15 0x080545b8 in do_action (a=0x819e570, msg=0x81c0c38) at action.c:675
#16 0x08054a7b in run_actions (a=0x8199b5c, msg=0x81c0c38) at action.c:920
#17 0x08095902 in receive_msg (
    buf=0x814e7a0 &quot;INVITE sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at 172.16.8.91</A>:7061;transport=tls 
SIP/2.0\r\nRecord-Route: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">mt at scscf.open-ims.test</A>:6060;lr&gt;\r\nRoute: 
&lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">term at pcscf.open-ims.test</A>:4060;lr&gt;\r\nRecord-Route: 
&lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">mo at scscf.open-ims.test</A>:60&quot;..., len=1496,
    rcv_info=0xbf996868) at receive.c:171
#18 0x080d371d in udp_rcv_loop () at udp_server.c:496
#19 0x0807e3e1 in main_loop () at main.c:1025
#20 0x0807f8a1 in main (argc=Cannot access memory at address 0x1
) at main.c:1614
(gdb)
----------------------------------------------------------------------------------------------------------------------------
/********** Registration  of  Callee in TLS *************************/
REGISTER sip:open-ims.test SIP/2.0
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;;tag=1239096542487712706
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">536816611785432770 at 1239096542487712706</A>
CSeq: 1 REGISTER
Via: SIP/2.0/UDP 172.16.8.91:7060;rport;branch=z9hG4bK575850211824466375
Max-Forwards: 70
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at 172.16.8.91</A>:7060&gt;
Expires: 300
P-Access-Network-Info: UTRAN-TDD;utran-cel-id-3gpp=234151D0FCE11
Privacy: user
Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&quot;, 
realm=&quot;open-ims.test&quot;, nonce=&quot;&quot;, uri=&quot;sip:open-ims.test&quot;, response=&quot;&quot;
Content-Length: 0
Route: &lt;sip:pcscf.open-ims.test:4060;lr;transport=udp&gt;
Supported: path,sec-agree
Security-Client: tls

-------------------------
Received Data =
SIP/2.0 401 Unauthorized - Challenging the UE
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;;tag=1239096542487712706
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;;tag=bee61c104ad15a8a63709cad2c561dab-3276
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">536816611785432770 at 1239096542487712706</A>
CSeq: 1 REGISTER
Via: SIP/2.0/UDP 
172.16.8.91:7060;rport=7060;branch=z9hG4bK575850211824466375
Path: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">term at pcscf.open-ims.test</A>:4060;lr&gt;
Service-Route: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">orig at scscf.open-ims.test</A>:6060;lr&gt;
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, 
PUBLISH, MESSAGE, INFO
Server: Sip EXpress router (2.1.0-dev1 OpenIMSCore (i386/linux))
Content-Length: 0
WWW-Authenticate: Digest realm=&quot;open-ims.test&quot;, 
nonce=&quot;4a4b62d09d6bafeed4a4f5754ad47f34&quot;, algorithm=MD5, qop=&quot;auth,auth-int&quot;
Security-Server: tls

----------------------
REGISTER sip:open-ims.test SIP/2.0
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;;tag=1239096542487712706
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">536816611785432770 at 1239096542487712706</A>
CSeq: 2 REGISTER
Via: SIP/2.0/TLS 172.16.8.91:7061;rport;branch=z9hG4bK569635851818252014
Max-Forwards: 70
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at 172.16.8.91</A>:7061;transport=tls&gt;
Expires: 300
P-Access-Network-Info: UTRAN-TDD;utran-cel-id-3gpp=234151D0FCE11
Privacy: user
Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&quot;, 
realm=&quot;open-ims.test&quot;, nonce=&quot;4a4b62d09d6bafeed4a4f5754ad47f34&quot;, 
uri=&quot;sip:open-ims.test&quot;, response=&quot;b3389c88c50d6116838f160401ff03ab&quot;, 
algorithm=MD5,cnonce=&quot;a2fc72d132664b2d11b6a55798970865&quot;,qop=auth-int,nc=00000001
Content-Length: 0
Route: &lt;sip:pcscf.open-ims.test:4060;lr;transport=udp&gt;
Supported: path,sec-agree
Security-Client: tls
Security-Verify: tls

-------------------------------------
Received Data =
SIP/2.0 200 OK - SAR succesful and registrar saved
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;;tag=1239096542487712706
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;;tag=bee61c104ad15a8a63709cad2c561dab-e65d
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">536816611785432770 at 1239096542487712706</A>
CSeq: 2 REGISTER
Via: SIP/2.0/TLS 
172.16.8.91:7061;rport=51012;branch=z9hG4bK569635851818252014
P-Associated-URI: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at 172.16.8.91</A>:7061;transport=tls&gt;;expires=300
Path: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">term at pcscf.open-ims.test</A>:4060;lr&gt;
Service-Route: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">orig at scscf.open-ims.test</A>:6060;lr&gt;
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, 
PUBLISH, MESSAGE, INFO
P-Charging-Function-Addresses: ccf=pri_ccf_address
Server: Sip EXpress router (2.1.0-dev1 OpenIMSCore (i386/linux))
Content-Length: 0

------------------------------
/********************     Registration of Calling party in TLS    
*************************/
REGISTER sip:open-ims.test SIP/2.0
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=270331331518967271
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">1839643193088279134 at 270331331518967271</A>
CSeq: 1 REGISTER
Via: SIP/2.0/UDP 172.16.5.32:8060;rport;branch=z9hG4bK2028582743277218688
Max-Forwards: 70
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at 172.16.5.32</A>:8060&gt;
Expires: 300
P-Access-Network-Info: UTRAN-TDD;utran-cel-id-3gpp=234151D0FCE11
Privacy: user
Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&quot;, 
realm=&quot;open-ims.test&quot;, nonce=&quot;&quot;, uri=&quot;sip:open-ims.test&quot;, response=&quot;&quot;
Content-Length: 0
Route: &lt;sip:pcscf.open-ims.test:4060;lr;transport=udp&gt;
Supported: path,sec-agree
Security-Client: tls

----------------------------
SIP/2.0 401 Unauthorized - Challenging the UE
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=270331331518967271
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=bee61c104ad15a8a63709cad2c561dab-5744
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">1839643193088279134 at 270331331518967271</A>
CSeq: 1 REGISTER
Via: SIP/2.0/UDP 
172.16.5.32:8060;rport=8060;branch=z9hG4bK2028582743277218688
Path: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">term at pcscf.open-ims.test</A>:4060;lr&gt;
Service-Route: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">orig at scscf.open-ims.test</A>:6060;lr&gt;
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, 
PUBLISH, MESSAGE, INFO
Server: Sip EXpress router (2.1.0-dev1 OpenIMSCore (i386/linux))
Content-Length: 0
WWW-Authenticate: Digest realm=&quot;open-ims.test&quot;, 
nonce=&quot;35d7dcdce7dbc33707aa5cc63c7a6964&quot;, algorithm=MD5, qop=&quot;auth,auth-int&quot;
Security-Server: tls

----------------------------------------------
REGISTER sip:open-ims.test SIP/2.0
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=270331331518967271
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">1839643193088279134 at 270331331518967271</A>
CSeq: 2 REGISTER
Via: SIP/2.0/TLS 172.16.5.32:8061;rport;branch=z9hG4bK1764285653012921600
Max-Forwards: 70
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at 172.16.5.32</A>:8061;transport=tls&gt;
Expires: 300
User_Agent: gesSipPhone/1.0 (GESL)
P-Access-Network-Info: UTRAN-TDD;utran-cel-id-3gpp=234151D0FCE11
Privacy: user
Authorization: Digest username=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&quot;, 
realm=&quot;open-ims.test&quot;, nonce=&quot;35d7dcdce7dbc33707aa5cc63c7a6964&quot;, 
uri=&quot;sip:open-ims.test&quot;, response=&quot;8a3067cf6920e9faf7054cd0ce4be1ac&quot;, 
algorithm=MD5,cnonce=&quot;a2fc72d132664b2d11b6a55798970865&quot;,qop=auth-int,nc=00000001
Content-Length: 0
Route: &lt;sip:pcscf.open-ims.test:4060;lr;transport=udp&gt;
Supported: path,sec-agree
Security-Client: tls
Security-Verify: tls

--------------------------------------
Received Data =
SIP/2.0 200 OK - SAR succesful and registrar saved
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=270331331518967271
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=bee61c104ad15a8a63709cad2c561dab-db78
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">1839643193088279134 at 270331331518967271</A>
CSeq: 2 REGISTER
Via: SIP/2.0/TLS 
172.16.5.32:8061;rport=57818;branch=z9hG4bK1764285653012921600
P-Associated-URI: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at 172.16.5.32</A>:8061;transport=tls&gt;;expires=300
Path: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">term at pcscf.open-ims.test</A>:4060;lr&gt;
Service-Route: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">orig at scscf.open-ims.test</A>:6060;lr&gt;
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, SUBSCRIBE, NOTIFY, 
PUBLISH, MESSAGE, INFO
P-Charging-Function-Addresses: ccf=pri_ccf_address
Server: Sip EXpress router (2.1.0-dev1 OpenIMSCore (i386/linux))
Content-Length: 0

/*************           INVITE Method      *****************/
INVITE sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A> SIP/2.0
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=1134535002383170961
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">30923301279559253 at 1134535002383170961</A>
CSeq: 1 INVITE
Via: SIP/2.0/TLS 172.16.5.32:8061;rport;branch=z9hG4bK77442001326077955
Max-Forwards: 70
Contact: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at 172.16.5.32</A>:8061;transport=tls&gt;
Expires: 50
P-Access-Network-Info: UTRAN-TDD;utran-cel-id-3gpp=234151D0FCE11
Content-Length: 187
Content-Type: application/sdp;boundary=end
Allow: 
INVITE,ACK,OPTIONS,BYE,CANCEL,REGISTER,NOTIFY,SUBSCRIBE,INFO,PRACK,UPDATE,PUBLISH
Route: 
&lt;sip:pcscf.open-ims.test:4060;lr;transport=udp&gt;,&lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">orig at scscf.open-ims.test</A>:6060;lr&gt;
Supported: path,sec-agree
Security-Verify: tls
Allow-Events: message-summary,reg

v=0
o=- 1559973916 306085717 IN IP4 172.16.5.32
s=-
c=IN IP4 172.16.5.32
b=AS:64
t=0 0
m=audio 8002 RTP/AVP 0 8
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=ptime:20
a=sendrecv
---------------------------------------------------------------------

Received Data =
SIP/2.0 100 trying -- your call is important to us
From: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">bob at open-ims.test</A>&gt;;tag=1134535002383170961
To: &lt;sip:<A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">alice at open-ims.test</A>&gt;
Call-ID: <A HREF="https://lists.berlios.de/mailman/listinfo/openimscore-users">30923301279559253 at 1134535002383170961</A>
CSeq: 1 INVITE
Via: SIP/2.0/TLS 
172.16.5.32:8061;rport=57818;branch=z9hG4bK77442001326077955
Server: Sip EXpress router (2.1.0-dev1 OpenIMSCore (i386/linux))
Content-Length: 0
----------------------------------------------


Thanks,
Prashanth M E
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/openimscore-users/attachments/20090726/64763a5e/attachment.html">https://lists.berlios.de/pipermail/openimscore-users/attachments/20090726/64763a5e/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005651.html">[OpenIMSCore-Users] I-CSCF rejecting REGISTER with 600	Busy	everywhere
</A></li>
	<LI>Next message: <A HREF="005641.html">[OpenIMSCore-Users] Trigger-point matches where it should not
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5640">[ date ]</a>
              <a href="thread.html#5640">[ thread ]</a>
              <a href="subject.html#5640">[ subject ]</a>
              <a href="author.html#5640">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openimscore-users">More information about the OpenIMSCore-Users
mailing list</a><br>
</body></html>
